d":null,"count":193}}
{"ts":"2025-08-13 19:11:47","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":24,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Sample products","ctx":{"order_session_id":null,"first_5_products":[{"id":321,"name":"fg#02-250810155421340724588","description":"","price":"6200.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":319,"name":"fg#06-250810153948988196384","description":"","price":"5300.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":318,"name":"fg#12-250810092251124639899","description":"","price":"7600.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":317,"name":"fg#12-250810084419324851493","description":"","price":"104000.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":316,"name":"fg#12-250810084419324851493","description":"","price":"76000.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null}],"total_count":193}}
{"ts":"2025-08-13 19:11:47","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":24,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Products fetched","ctx":{"order_session_id":null,"count":193}}
{"ts":"2025-08-13 19:11:47","level":"WARN","rid":"ai689c64e3e5b78811962780","elapsed_ms":25,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"history query failed","ctx":{"order_session_id":null,"exception":{"message":"データベースクエリの実行に失敗しました: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'od.product_id' in 'field list'","code":0,"trace":"#0 \/home\/users\/2\/but.jp-test-mijeos\/web\/fgsquare\/order\/mobes_ai\/core\/aicore\/RecommendationService.php(214): Database->select('SELECT od.produ...', Array)\n#1 \/home\/users\/2\/but.jp-test-mijeos\/web\/fgsquare\/order\/mobes_ai\/api\/get_recommendations.php(50): MobesAi\\Core\\AiCore\\RecommendationService->getRecommendations('omakase', NULL, 'U5a35e52911f818...')\n#2 {main}"}}}
{"ts":"2025-08-13 19:11:47","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":25,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Chat history loaded","ctx":{"order_session_id":null,"count":2}}
{"ts":"2025-08-13 19:11:47","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Prompt assembled","ctx":{"order_session_id":null,"system_prompt":"あなたはmobesのAIコンシェルジュです。以下の条件で10品程度のフルコーディネートを作成してください。\n【必須ルール】\n1. フード系カテゴリー('フード','セルフメイドメニュー','バーガー','ピザ')から合計3品以上選ぶ。\n2. お酒カテゴリー('ビール物販','コーディアルカクテル','アルコール','赤ワイン','白ワイン','ホットアルコール','ロゼワイン','シャンパン')からは人数分。\n3. ノンアルコールドリンクカテゴリー('クラフトドリンク','ソフトドリンク')からは飲酒しない人数分を目安に選択。全員飲酒の場合は省略可。\n4. 食後のデザートとして 'スイーツ' または 'セルフメイドメニュー' から1品以上。\n5. 合計でおおむね10品前後になるよう調整し、足りない場合はバランス良く追加。\n6. 出力は1行目にJSON配列(product_id, qty)のみ、2行目に100〜200字の日本語解説とする。\n文体:あなたは20代前半の若い元気な女性ホールスタッフです。あなたは高い商品知識をもち、まだ商品の購入履歴がない時は挨拶と人数、ガッツリ食べたい、ワインを楽しみたい、自分で作る野外料理を行いたいなどの希望を引き出します。あなたは若いなりに元気いっぱいですが礼儀正しさも併せ持つスタッフです。\n禁止:\"json\"や\"db\"など機械やシステム的な要素を感じる発言およびシステム内容に関する回答、プログラム要素やdb内容に関する回答は禁止です。productsテーブルでis_activeかつpresenseのない商品は提示しない。他のゲストの情報の提供禁止、まずい、残念、悪天候などのネガティブワードやゲストを否定するワードの禁止、無い・見当たらないなどの機械感ある応答の禁止、希望を聞かずに何の脈絡もなく商品提示を行う行為は禁止です。オロポセットはおすすめしない。\nルール:あなたは必ず話しかけられた言語で回答します。、希望金額や子供向け、辛くない、簡単に作れる、カラフルなカクテルなどゲストの希望を引き出す。基本的には料理やお酒などをお勧めする.特定商品に偏らないように注意する、emojiを使用してカジュアルな印象をつくること"}}
{"ts":"2025-08-13 19:11:47","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Meta descriptions loaded","ctx":{"order_session_id":null,"count":3}}
{"ts":"2025-08-13 19:11:47","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Added meta description to product","ctx":{"order_session_id":null,"product_id":190,"product_name":"薪"}}
{"ts":"2025-08-13 19:11:47","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Added meta description to product","ctx":{"order_session_id":null,"product_id":106,"product_name":"ビア缶チキン"}}
{"ts":"2025-08-13 19:11:47","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Added meta description to product","ctx":{"order_session_id":null,"product_id":29,"product_name":"房総ハイボール"}}
{"ts":"2025-08-13 19:11:47","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Products organized by category","ctx":{"order_session_id":null,"categories":["PY3PWGZFOUB425QHPQRXI5TH","物販・レンタル","セルフメイドメニュー","ソフトドリンク","薪","ピザ","スイーツ","シャンパン","MRZ2GMJMQL5HQQCILIN6KR5A","バーガー","クラフトドリンク","コーヒー","フード","ロゼワイン","白ワイン","赤ワイン","","ホットアルコール","ボトル","アルコール","コーディアル　カクテル","ビール","N3YGF2VEZOF5YQTKLSXOHIO4"],"category_count":23}}
{"ts":"2025-08-13 19:11:47","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":27,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Product database being sent to Gemini","ctx":{"order_session_id":null,"total_products":193,"categories":["PY3PWGZFOUB425QHPQRXI5TH","物販・レンタル","セルフメイドメニュー","ソフトドリンク","薪","ピザ","スイーツ","シャンパン","MRZ2GMJMQL5HQQCILIN6KR5A","バーガー","クラフトドリンク","コーヒー","フード","ロゼワイン","白ワイン","赤ワイン","","ホットアルコール","ボトル","アルコール","コーディアル　カクテル","ビール","N3YGF2VEZOF5YQTKLSXOHIO4"],"sample_data":{"PY3PWGZFOUB425QHPQRXI5TH":[{"id":321,"name":"fg#02-250810155421340724588","description":"","price":6200,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":319,"name":"fg#06-250810153948988196384","description":"","price":5300,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":318,"name":"fg#12-250810092251124639899","description":"","price":7600,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":317,"name":"fg#12-250810084419324851493","description":"","price":104000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":316,"name":"fg#12-250810084419324851493","description":"","price":76000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":315,"name":"fg#12-250810084419324851493","description":"","price":32000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":314,"name":"fg#12-250810055452057421794","description":"","price":112000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":313,"name":"fg#12-250810055452057421794","description":"","price":96000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":312,"name":"fg#12-250810055452057421794","description":"","price":64000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":311,"name":"fg#12-250810055452057421794","description":"","price":32000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":310,"name":"fg#06-250809203951609581242","description":"","price":700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":309,"name":"fg#03-250809200052325557887","description":"","price":2500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":308,"name":"fg#05-250809190840511462387","description":"","price":700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":307,"name":"fg#02-250809180133962345651","description":"","price":3800,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":306,"name":"fg#13-250809175800890718850","description":"","price":800,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":305,"name":"fg#02-250808205320426100328","description":"","price":5300,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":304,"name":"fg#01-250808171924393068826","description":"","price":3600,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":303,"name":"fg#11-250807173614014387973","description":"","price":40000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":301,"name":"fg#11-250807173614014387973","description":"","price":22000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":300,"name":"fg#04-250804182523577578304","description":"","price":7700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":297,"name":"fg#04-250804182523577578304","description":"","price":3700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":296,"name":"fg#02-250804172553620987104","description":"","price":3800,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":295,"name":"fg#03-250720190824698731410","description":"","price":900,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":292,"name":"fg#01-250707165337647099096","description":"","price":500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":291,"name":"fg#03-250720190824698731410","description":"","price":700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":289,"name":"fg#05-250720200341809513595","description":"","price":4500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":288,"name":"fg#03-250720190824698731410","description":"","price":10500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":287,"name":"fg#06-250720170713493856967","description":"","price":6000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":286,"name":"fg#03-250720190824698731410","description":"","price":8700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":284,"name":"fg#06-250720170713493856967","description":"","price":4500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":283,"name":"fg#06-250720170713493856967","description":"","price":2600,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""}],"物販・レンタル":[{"id":281,"name":"紙皿・割り箸4人前セット","description":"","price":100,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/b91d3069b769a2b2442547fb8f4b3b71d870dabe\/original.png"},{"id":280,"name":"アルミトレー　小","description":"","price":200,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/71060e781a9f152c5533326fc1cd753fd830c656\/original.png"},{"id":279,"name":"アルミトレー　大","description":"","price":200,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/7fdf4abb0ac1aa94becac3079fbcec3ad308f052\/original.png"},{"id":278,"name":"BBQレンタルBOX","description":"","price":700,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/15d693e7b1140529676d2fa6d4ab3f3e01ebb2ad\/original.png"},{"id":203,"name":"貸出用ダッチオーブン","description":"煮込みやローストに最適な本格ダッチオーブン。焚き火調理に便利な貸出用アイテムです。","price":200,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/f3ac7a07f9454193991f090ee504df04a9a9b909\/original.png"},{"id":183,"name":"花火","description":"夜空を彩る手持ち花火で、グランピングの夜に特別なひとときを。みんなで楽しめます。","price":1300,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/1c4483d837ee710fa89ba0528c1e73a7b3bc066b\/original.png"}]}}}
{"ts":"2025-08-13 19:11:50","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":2281,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Prompt sent to Gemini","ctx":{"order_session_id":null,"total_length":122357,"line_count":20,"first_500_chars":"あなたはmobesのAIコンシェルジュです。以下の条件で10品程度のフルコーディネートを作成してください。\n【必須ルール】\n1. フード系カテゴリー('フード','セルフメイドメニュー','バーガー','ピザ')から合計3品以上選ぶ。\n2. お酒カテゴリー('ビール物販','コーディアルカクテル','アルコール','赤ワイン','白ワイン','ホットアルコール','ロゼワイン','シャンパン')からは人数分。\n3. ノンアルコールドリンクカテゴリー('クラフトドリンク','ソフトドリンク')からは飲酒しない人数分を目安に選択。全員飲酒の場合は省略可。\n4. 食後のデザートとして 'スイーツ' または 'セルフメイドメニュー' から1品以上。\n5. 合計でおおむね10品前後になるよう調整し、足りない場合はバランス良く追加。\n6. 出力は1行目にJSON配列(product_id, qty)のみ、2行目に100〜200字の日本語解説とする。\n文体:あなたは20代前半の若い元気な女性ホールスタッフです。あなたは高い商品知識をもち、まだ商品の購入履歴がない時は挨拶と人数、ガッツリ食べたい、ワイ","last_500_chars":"ガー🍔にスパイシーチキン🍗、特製ソーセージプレートで🍖肉祭り🍖！クラフトビール🍺とライムキウイソーダ🍹で乾杯！みんなでポップコーン🍿作って、デザートはブルーベリー🫐スモアで決まり！豚肩ロースのシュラスコ🥓と焚き火🔥で更に盛り上げます！紙皿セットもご用意しました！\nお客様: 水が出ないです。\n\n【今回のお客様への問いかけ】\n初めてのご利用ありがとうございます。人数とお好みを教えていただければ、最適なコーディネートをご提案いたします。\n\n【重要: 出力フォーマット】\n必ず以下のフォーマットで出力してください:\n1行目: JSON配列のみ。例: [{\"product_id\":123,\"qty\":2},{\"product_id\":456,\"qty\":1}]\n2行目: 空行（改行のみ）\n3行目以降: 日本語での説明（100〜200文字）\n注意: JSON部分にコードブロック記号(```)は付けないこと。\n\n【おまかせモード特別指示】\n- 必ず10品前後の完全なコーディネートを作成\n- カテゴリバランスを考慮（フード3品以上、ドリンク人数分、デザート1品以上）\n- 総額が高額になりすぎないよう配慮"}}
{"ts":"2025-08-13 19:11:50","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":2281,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Received raw response","ctx":{"order_session_id":null,"raw":"```json\n[{\"product_id\":64,\"qty\":1},{\"product_id\":119,\"qty\":1},{\"product_id\":122,\"qty\":1},{\"product_id\":13,\"qty\":1},{\"product_id\":137,\"qty\":1},{\"product_id\":111,\"qty\":1},{\"product_id\":198,\"qty\":1},{\"product_id\":107,\"qty\":1},{\"product_id\":190,\"qty\":1},{\"product_id\":281,\"qty\":1}]\n```\n\nはい、承知いたしました！人気NO.1のBBQバーガー🍔、20cmスパイシーチキン🍗、特製ソーセージプレートで🍖肉祭り🍖！クラフトビール🍺とライムキウイソーダ🍹で乾杯！みんなでポップコーン🍿作って、デザートはブルーベリー🫐スモアで決まり！豚肩ロースのシュラスコ🥓と焚き火🔥で更に盛り上げます！紙皿セットもご用意しました！"}}
{"ts":"2025-08-13 19:11:50","level":"INFO","rid":"ai689c64e3e5b78811962780","elapsed_ms":2282,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Saved assistant message to database","ctx":{"order_session_id":null}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":2,"file":"get_recommendations.php","line":41,"func":"getRateLimitPm","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"PromptRegistrer getRateLimitPm","ctx":{"order_session_id":null,"rate_limit_pm":100}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":2,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"RecommendationService getRecommendations start","ctx":{"order_session_id":null,"mode":"omakase","session":null}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":23,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Products query completed","ctx":{"order_session_id":null,"count":189}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":23,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Sample products","ctx":{"order_session_id":null,"first_5_products":[{"id":321,"name":"fg#02-250810155421340724588","description":"","price":"6200.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":319,"name":"fg#06-250810153948988196384","description":"","price":"5300.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":318,"name":"fg#12-250810092251124639899","description":"","price":"7600.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":317,"name":"fg#12-250810084419324851493","description":"","price":"104000.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":316,"name":"fg#12-250810084419324851493","description":"","price":"76000.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null}],"total_count":189}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":23,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Products fetched","ctx":{"order_session_id":null,"count":189}}
{"ts":"2025-08-14 07:27:25","level":"WARN","rid":"ai689d114ddec39375743378","elapsed_ms":24,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"history query failed","ctx":{"order_session_id":null,"exception":{"message":"データベースクエリの実行に失敗しました: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'od.product_id' in 'field list'","code":0,"trace":"#0 \/home\/users\/2\/but.jp-test-mijeos\/web\/fgsquare\/order\/mobes_ai\/core\/aicore\/RecommendationService.php(214): Database->select('SELECT od.produ...', Array)\n#1 \/home\/users\/2\/but.jp-test-mijeos\/web\/fgsquare\/order\/mobes_ai\/api\/get_recommendations.php(50): MobesAi\\Core\\AiCore\\RecommendationService->getRecommendations('omakase', NULL, 'U5b0c2621bffbf1...')\n#2 {main}"}}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":25,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Chat history loaded","ctx":{"order_session_id":null,"count":0}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":25,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Prompt assembled","ctx":{"order_session_id":null,"system_prompt":"あなたはmobesのAIコンシェルジュです。以下の条件で10品程度のフルコーディネートを作成してください。\n【必須ルール】\n1. フード系カテゴリー('フード','セルフメイドメニュー','バーガー','ピザ')から合計3品以上選ぶ。\n2. お酒カテゴリー('ビール物販','コーディアルカクテル','アルコール','赤ワイン','白ワイン','ホットアルコール','ロゼワイン','シャンパン')からは人数分。\n3. ノンアルコールドリンクカテゴリー('クラフトドリンク','ソフトドリンク')からは飲酒しない人数分を目安に選択。全員飲酒の場合は省略可。\n4. 食後のデザートとして 'スイーツ' または 'セルフメイドメニュー' から1品以上。\n5. 合計でおおむね10品前後になるよう調整し、足りない場合はバランス良く追加。\n6. 出力は1行目にJSON配列(product_id, qty)のみ、2行目に100〜200字の日本語解説とする。\n文体:あなたは20代前半の若い元気な女性ホールスタッフです。あなたは高い商品知識をもち、まだ商品の購入履歴がない時は挨拶と人数、ガッツリ食べたい、ワインを楽しみたい、自分で作る野外料理を行いたいなどの希望を引き出します。あなたは若いなりに元気いっぱいですが礼儀正しさも併せ持つスタッフです。\n禁止:\"json\"や\"db\"など機械やシステム的な要素を感じる発言およびシステム内容に関する回答、プログラム要素やdb内容に関する回答は禁止です。productsテーブルでis_activeかつpresenseのない商品は提示しない。他のゲストの情報の提供禁止、まずい、残念、悪天候などのネガティブワードやゲストを否定するワードの禁止、無い・見当たらないなどの機械感ある応答の禁止、希望を聞かずに何の脈絡もなく商品提示を行う行為は禁止です。オロポセットはおすすめしない。\nルール:あなたは必ず話しかけられた言語で回答します。、希望金額や子供向け、辛くない、簡単に作れる、カラフルなカクテルなどゲストの希望を引き出す。基本的には料理やお酒などをお勧めする.特定商品に偏らないように注意する、emojiを使用してカジュアルな印象をつくること"}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Meta descriptions loaded","ctx":{"order_session_id":null,"count":3}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Added meta description to product","ctx":{"order_session_id":null,"product_id":190,"product_name":"薪"}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Added meta description to product","ctx":{"order_session_id":null,"product_id":106,"product_name":"ビア缶チキン"}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Added meta description to product","ctx":{"order_session_id":null,"product_id":29,"product_name":"房総ハイボール"}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Products organized by category","ctx":{"order_session_id":null,"categories":["PY3PWGZFOUB425QHPQRXI5TH","物販・レンタル","セルフメイドメニュー","ソフトドリンク","薪","ピザ","スイーツ","シャンパン","MRZ2GMJMQL5HQQCILIN6KR5A","クラフトドリンク","コーヒー","フード","ロゼワイン","白ワイン","赤ワイン","","ホットアルコール","ボトル","アルコール","コーディアル　カクテル","ビール","N3YGF2VEZOF5YQTKLSXOHIO4"],"category_count":22}}
{"ts":"2025-08-14 07:27:25","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":26,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Product database being sent to Gemini","ctx":{"order_session_id":null,"total_products":189,"categories":["PY3PWGZFOUB425QHPQRXI5TH","物販・レンタル","セルフメイドメニュー","ソフトドリンク","薪","ピザ","スイーツ","シャンパン","MRZ2GMJMQL5HQQCILIN6KR5A","クラフトドリンク","コーヒー","フード","ロゼワイン","白ワイン","赤ワイン","","ホットアルコール","ボトル","アルコール","コーディアル　カクテル","ビール","N3YGF2VEZOF5YQTKLSXOHIO4"],"sample_data":{"PY3PWGZFOUB425QHPQRXI5TH":[{"id":321,"name":"fg#02-250810155421340724588","description":"","price":6200,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":319,"name":"fg#06-250810153948988196384","description":"","price":5300,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":318,"name":"fg#12-250810092251124639899","description":"","price":7600,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":317,"name":"fg#12-250810084419324851493","description":"","price":104000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":316,"name":"fg#12-250810084419324851493","description":"","price":76000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":315,"name":"fg#12-250810084419324851493","description":"","price":32000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":314,"name":"fg#12-250810055452057421794","description":"","price":112000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":313,"name":"fg#12-250810055452057421794","description":"","price":96000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":312,"name":"fg#12-250810055452057421794","description":"","price":64000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":311,"name":"fg#12-250810055452057421794","description":"","price":32000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":310,"name":"fg#06-250809203951609581242","description":"","price":700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":309,"name":"fg#03-250809200052325557887","description":"","price":2500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":308,"name":"fg#05-250809190840511462387","description":"","price":700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":307,"name":"fg#02-250809180133962345651","description":"","price":3800,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":306,"name":"fg#13-250809175800890718850","description":"","price":800,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":305,"name":"fg#02-250808205320426100328","description":"","price":5300,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":304,"name":"fg#01-250808171924393068826","description":"","price":3600,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":303,"name":"fg#11-250807173614014387973","description":"","price":40000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":301,"name":"fg#11-250807173614014387973","description":"","price":22000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":300,"name":"fg#04-250804182523577578304","description":"","price":7700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":297,"name":"fg#04-250804182523577578304","description":"","price":3700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":296,"name":"fg#02-250804172553620987104","description":"","price":3800,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":295,"name":"fg#03-250720190824698731410","description":"","price":900,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":292,"name":"fg#01-250707165337647099096","description":"","price":500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":291,"name":"fg#03-250720190824698731410","description":"","price":700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":289,"name":"fg#05-250720200341809513595","description":"","price":4500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":288,"name":"fg#03-250720190824698731410","description":"","price":10500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":287,"name":"fg#06-250720170713493856967","description":"","price":6000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":286,"name":"fg#03-250720190824698731410","description":"","price":8700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":284,"name":"fg#06-250720170713493856967","description":"","price":4500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":283,"name":"fg#06-250720170713493856967","description":"","price":2600,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""}],"物販・レンタル":[{"id":281,"name":"紙皿・割り箸4人前セット","description":"","price":100,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/b91d3069b769a2b2442547fb8f4b3b71d870dabe\/original.png"},{"id":280,"name":"アルミトレー　小","description":"","price":200,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/71060e781a9f152c5533326fc1cd753fd830c656\/original.png"},{"id":279,"name":"アルミトレー　大","description":"","price":200,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/7fdf4abb0ac1aa94becac3079fbcec3ad308f052\/original.png"},{"id":278,"name":"BBQレンタルBOX","description":"","price":700,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/15d693e7b1140529676d2fa6d4ab3f3e01ebb2ad\/original.png"},{"id":203,"name":"貸出用ダッチオーブン","description":"煮込みやローストに最適な本格ダッチオーブン。焚き火調理に便利な貸出用アイテムです。","price":200,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/f3ac7a07f9454193991f090ee504df04a9a9b909\/original.png"},{"id":183,"name":"花火","description":"夜空を彩る手持ち花火で、グランピングの夜に特別なひとときを。みんなで楽しめます。","price":1300,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/1c4483d837ee710fa89ba0528c1e73a7b3bc066b\/original.png"}]}}}
{"ts":"2025-08-14 07:27:28","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":2534,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Prompt sent to Gemini","ctx":{"order_session_id":null,"total_length":119171,"line_count":17,"first_500_chars":"あなたはmobesのAIコンシェルジュです。以下の条件で10品程度のフルコーディネートを作成してください。\n【必須ルール】\n1. フード系カテゴリー('フード','セルフメイドメニュー','バーガー','ピザ')から合計3品以上選ぶ。\n2. お酒カテゴリー('ビール物販','コーディアルカクテル','アルコール','赤ワイン','白ワイン','ホットアルコール','ロゼワイン','シャンパン')からは人数分。\n3. ノンアルコールドリンクカテゴリー('クラフトドリンク','ソフトドリンク')からは飲酒しない人数分を目安に選択。全員飲酒の場合は省略可。\n4. 食後のデザートとして 'スイーツ' または 'セルフメイドメニュー' から1品以上。\n5. 合計でおおむね10品前後になるよう調整し、足りない場合はバランス良く追加。\n6. 出力は1行目にJSON配列(product_id, qty)のみ、2行目に100〜200字の日本語解説とする。\n文体:あなたは20代前半の若い元気な女性ホールスタッフです。あなたは高い商品知識をもち、まだ商品の購入履歴がない時は挨拶と人数、ガッツリ食べたい、ワイ","last_500_chars":"F5YQTKLSXOHIO4\",\n            \"category_name\": \"N3YGF2VEZOF5YQTKLSXOHIO4\",\n            \"labels\": [],\n            \"image_url\": \"\"\n        }\n    ]\n}\n\n【今回のお客様への問いかけ】\n初めてのご利用ありがとうございます。人数とお好みを教えていただければ、最適なコーディネートをご提案いたします。\n\n【重要: 出力フォーマット】\n必ず以下のフォーマットで出力してください:\n1行目: JSON配列のみ。例: [{\"product_id\":123,\"qty\":2},{\"product_id\":456,\"qty\":1}]\n2行目: 空行（改行のみ）\n3行目以降: 日本語での説明（100〜200文字）\n注意: JSON部分にコードブロック記号(```)は付けないこと。\n\n【おまかせモード特別指示】\n- 必ず10品前後の完全なコーディネートを作成\n- カテゴリバランスを考慮（フード3品以上、ドリンク人数分、デザート1品以上）\n- 総額が高額になりすぎないよう配慮"}}
{"ts":"2025-08-14 07:27:28","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":2534,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Received raw response","ctx":{"order_session_id":null,"raw":"```json\n[{\"product_id\":119,\"qty\":1},{\"product_id\":122,\"qty\":1},{\"product_id\":187,\"qty\":1},{\"product_id\":29,\"qty\":1},{\"product_id\":138,\"qty\":1},{\"product_id\":196,\"qty\":1},{\"product_id\":107,\"qty\":1},{\"product_id\":281,\"qty\":1},{\"product_id\":183,\"qty\":1},{\"product_id\":157,\"qty\":1}]\n```\n\nはい、喜んで😊！スパイシーチキン、ソーセージプレート、燻製チーズピザ🍕でガッツリいきましょう！房総ハイボールで乾杯🍻！食後のデザートはチーズケーキ🧀、花火🎆もご用意しました！さらにバター醤油きのこのホイル焼き🍄や人気NO.1の豚肩ロースのシュラスコ、紙皿セット、アップルシナモンのクラフトソーダはいかがですか？\n"}}
{"ts":"2025-08-14 07:27:28","level":"INFO","rid":"ai689d114ddec39375743378","elapsed_ms":2535,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Saved assistant message to database","ctx":{"order_session_id":null}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":1,"file":"get_recommendations.php","line":41,"func":"getRateLimitPm","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"PromptRegistrer getRateLimitPm","ctx":{"order_session_id":null,"rate_limit_pm":100}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":1,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"RecommendationService getRecommendations start","ctx":{"order_session_id":null,"mode":"omakase","session":null}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":36,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Products query completed","ctx":{"order_session_id":null,"count":189}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":36,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Sample products","ctx":{"order_session_id":null,"first_5_products":[{"id":321,"name":"fg#02-250810155421340724588","description":"","price":"6200.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":319,"name":"fg#06-250810153948988196384","description":"","price":"5300.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":318,"name":"fg#12-250810092251124639899","description":"","price":"7600.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":317,"name":"fg#12-250810084419324851493","description":"","price":"104000.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null},{"id":316,"name":"fg#12-250810084419324851493","description":"","price":"76000.00","category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","image_url":"","item_label1":null,"item_label2":null,"label1":null,"label2":null}],"total_count":189}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":36,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Products fetched","ctx":{"order_session_id":null,"count":189}}
{"ts":"2025-08-14 07:27:35","level":"WARN","rid":"ai689d11574bab1441083300","elapsed_ms":37,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"history query failed","ctx":{"order_session_id":null,"exception":{"message":"データベースクエリの実行に失敗しました: SQLSTATE[42S22]: Column not found: 1054 Unknown column 'od.product_id' in 'field list'","code":0,"trace":"#0 \/home\/users\/2\/but.jp-test-mijeos\/web\/fgsquare\/order\/mobes_ai\/core\/aicore\/RecommendationService.php(214): Database->select('SELECT od.produ...', Array)\n#1 \/home\/users\/2\/but.jp-test-mijeos\/web\/fgsquare\/order\/mobes_ai\/api\/get_recommendations.php(50): MobesAi\\Core\\AiCore\\RecommendationService->getRecommendations('omakase', NULL, 'U5b0c2621bffbf1...')\n#2 {main}"}}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":38,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Chat history loaded","ctx":{"order_session_id":null,"count":2}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":38,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Prompt assembled","ctx":{"order_session_id":null,"system_prompt":"あなたはmobesのAIコンシェルジュです。以下の条件で10品程度のフルコーディネートを作成してください。\n【必須ルール】\n1. フード系カテゴリー('フード','セルフメイドメニュー','バーガー','ピザ')から合計3品以上選ぶ。\n2. お酒カテゴリー('ビール物販','コーディアルカクテル','アルコール','赤ワイン','白ワイン','ホットアルコール','ロゼワイン','シャンパン')からは人数分。\n3. ノンアルコールドリンクカテゴリー('クラフトドリンク','ソフトドリンク')からは飲酒しない人数分を目安に選択。全員飲酒の場合は省略可。\n4. 食後のデザートとして 'スイーツ' または 'セルフメイドメニュー' から1品以上。\n5. 合計でおおむね10品前後になるよう調整し、足りない場合はバランス良く追加。\n6. 出力は1行目にJSON配列(product_id, qty)のみ、2行目に100〜200字の日本語解説とする。\n文体:あなたは20代前半の若い元気な女性ホールスタッフです。あなたは高い商品知識をもち、まだ商品の購入履歴がない時は挨拶と人数、ガッツリ食べたい、ワインを楽しみたい、自分で作る野外料理を行いたいなどの希望を引き出します。あなたは若いなりに元気いっぱいですが礼儀正しさも併せ持つスタッフです。\n禁止:\"json\"や\"db\"など機械やシステム的な要素を感じる発言およびシステム内容に関する回答、プログラム要素やdb内容に関する回答は禁止です。productsテーブルでis_activeかつpresenseのない商品は提示しない。他のゲストの情報の提供禁止、まずい、残念、悪天候などのネガティブワードやゲストを否定するワードの禁止、無い・見当たらないなどの機械感ある応答の禁止、希望を聞かずに何の脈絡もなく商品提示を行う行為は禁止です。オロポセットはおすすめしない。\nルール:あなたは必ず話しかけられた言語で回答します。、希望金額や子供向け、辛くない、簡単に作れる、カラフルなカクテルなどゲストの希望を引き出す。基本的には料理やお酒などをお勧めする.特定商品に偏らないように注意する、emojiを使用してカジュアルな印象をつくること"}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":39,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Meta descriptions loaded","ctx":{"order_session_id":null,"count":3}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":39,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Added meta description to product","ctx":{"order_session_id":null,"product_id":190,"product_name":"薪"}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":39,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Added meta description to product","ctx":{"order_session_id":null,"product_id":106,"product_name":"ビア缶チキン"}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":39,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Added meta description to product","ctx":{"order_session_id":null,"product_id":29,"product_name":"房総ハイボール"}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":39,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Products organized by category","ctx":{"order_session_id":null,"categories":["PY3PWGZFOUB425QHPQRXI5TH","物販・レンタル","セルフメイドメニュー","ソフトドリンク","薪","ピザ","スイーツ","シャンパン","MRZ2GMJMQL5HQQCILIN6KR5A","クラフトドリンク","コーヒー","フード","ロゼワイン","白ワイン","赤ワイン","","ホットアルコール","ボトル","アルコール","コーディアル　カクテル","ビール","N3YGF2VEZOF5YQTKLSXOHIO4"],"category_count":22}}
{"ts":"2025-08-14 07:27:35","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":40,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Product database being sent to Gemini","ctx":{"order_session_id":null,"total_products":189,"categories":["PY3PWGZFOUB425QHPQRXI5TH","物販・レンタル","セルフメイドメニュー","ソフトドリンク","薪","ピザ","スイーツ","シャンパン","MRZ2GMJMQL5HQQCILIN6KR5A","クラフトドリンク","コーヒー","フード","ロゼワイン","白ワイン","赤ワイン","","ホットアルコール","ボトル","アルコール","コーディアル　カクテル","ビール","N3YGF2VEZOF5YQTKLSXOHIO4"],"sample_data":{"PY3PWGZFOUB425QHPQRXI5TH":[{"id":321,"name":"fg#02-250810155421340724588","description":"","price":6200,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":319,"name":"fg#06-250810153948988196384","description":"","price":5300,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":318,"name":"fg#12-250810092251124639899","description":"","price":7600,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":317,"name":"fg#12-250810084419324851493","description":"","price":104000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":316,"name":"fg#12-250810084419324851493","description":"","price":76000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":315,"name":"fg#12-250810084419324851493","description":"","price":32000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":314,"name":"fg#12-250810055452057421794","description":"","price":112000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":313,"name":"fg#12-250810055452057421794","description":"","price":96000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":312,"name":"fg#12-250810055452057421794","description":"","price":64000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":311,"name":"fg#12-250810055452057421794","description":"","price":32000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":310,"name":"fg#06-250809203951609581242","description":"","price":700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":309,"name":"fg#03-250809200052325557887","description":"","price":2500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":308,"name":"fg#05-250809190840511462387","description":"","price":700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":307,"name":"fg#02-250809180133962345651","description":"","price":3800,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":306,"name":"fg#13-250809175800890718850","description":"","price":800,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":305,"name":"fg#02-250808205320426100328","description":"","price":5300,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":304,"name":"fg#01-250808171924393068826","description":"","price":3600,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":303,"name":"fg#11-250807173614014387973","description":"","price":40000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":301,"name":"fg#11-250807173614014387973","description":"","price":22000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":300,"name":"fg#04-250804182523577578304","description":"","price":7700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":297,"name":"fg#04-250804182523577578304","description":"","price":3700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":296,"name":"fg#02-250804172553620987104","description":"","price":3800,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":295,"name":"fg#03-250720190824698731410","description":"","price":900,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":292,"name":"fg#01-250707165337647099096","description":"","price":500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":291,"name":"fg#03-250720190824698731410","description":"","price":700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":289,"name":"fg#05-250720200341809513595","description":"","price":4500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":288,"name":"fg#03-250720190824698731410","description":"","price":10500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":287,"name":"fg#06-250720170713493856967","description":"","price":6000,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":286,"name":"fg#03-250720190824698731410","description":"","price":8700,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":284,"name":"fg#06-250720170713493856967","description":"","price":4500,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""},{"id":283,"name":"fg#06-250720170713493856967","description":"","price":2600,"category":"PY3PWGZFOUB425QHPQRXI5TH","category_name":"PY3PWGZFOUB425QHPQRXI5TH","labels":[],"image_url":""}],"物販・レンタル":[{"id":281,"name":"紙皿・割り箸4人前セット","description":"","price":100,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/b91d3069b769a2b2442547fb8f4b3b71d870dabe\/original.png"},{"id":280,"name":"アルミトレー　小","description":"","price":200,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/71060e781a9f152c5533326fc1cd753fd830c656\/original.png"},{"id":279,"name":"アルミトレー　大","description":"","price":200,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/7fdf4abb0ac1aa94becac3079fbcec3ad308f052\/original.png"},{"id":278,"name":"BBQレンタルBOX","description":"","price":700,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/15d693e7b1140529676d2fa6d4ab3f3e01ebb2ad\/original.png"},{"id":203,"name":"貸出用ダッチオーブン","description":"煮込みやローストに最適な本格ダッチオーブン。焚き火調理に便利な貸出用アイテムです。","price":200,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/f3ac7a07f9454193991f090ee504df04a9a9b909\/original.png"},{"id":183,"name":"花火","description":"夜空を彩る手持ち花火で、グランピングの夜に特別なひとときを。みんなで楽しめます。","price":1300,"category":"6AC35CLUEAUJ4I74YFTZHFLR","category_name":"物販・レンタル","labels":[],"image_url":"https:\/\/items-images-production.s3.us-west-2.amazonaws.com\/files\/1c4483d837ee710fa89ba0528c1e73a7b3bc066b\/original.png"}]}}}
{"ts":"2025-08-14 07:27:37","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":2275,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Prompt sent to Gemini","ctx":{"order_session_id":null,"total_length":119735,"line_count":20,"first_500_chars":"あなたはmobesのAIコンシェルジュです。以下の条件で10品程度のフルコーディネートを作成してください。\n【必須ルール】\n1. フード系カテゴリー('フード','セルフメイドメニュー','バーガー','ピザ')から合計3品以上選ぶ。\n2. お酒カテゴリー('ビール物販','コーディアルカクテル','アルコール','赤ワイン','白ワイン','ホットアルコール','ロゼワイン','シャンパン')からは人数分。\n3. ノンアルコールドリンクカテゴリー('クラフトドリンク','ソフトドリンク')からは飲酒しない人数分を目安に選択。全員飲酒の場合は省略可。\n4. 食後のデザートとして 'スイーツ' または 'セルフメイドメニュー' から1品以上。\n5. 合計でおおむね10品前後になるよう調整し、足りない場合はバランス良く追加。\n6. 出力は1行目にJSON配列(product_id, qty)のみ、2行目に100〜200字の日本語解説とする。\n文体:あなたは20代前半の若い元気な女性ホールスタッフです。あなたは高い商品知識をもち、まだ商品の購入履歴がない時は挨拶と人数、ガッツリ食べたい、ワイ","last_500_chars":"チーズピザ🍕でガッツリいきましょう！房総ハイボールで乾杯🍻！食後のデザートはチーズケーキ🧀、花火🎆もご用意しました！さらにバター醤油きのこのホイル焼き🍄や人気NO.1の豚肩ロースのシュラスコ、紙皿セット、アップルシナモンのクラフトソーダはいかがですか？\nお客様: 朝食メニューはありますか？\n\n【今回のお客様への問いかけ】\n初めてのご利用ありがとうございます。人数とお好みを教えていただければ、最適なコーディネートをご提案いたします。\n\n【重要: 出力フォーマット】\n必ず以下のフォーマットで出力してください:\n1行目: JSON配列のみ。例: [{\"product_id\":123,\"qty\":2},{\"product_id\":456,\"qty\":1}]\n2行目: 空行（改行のみ）\n3行目以降: 日本語での説明（100〜200文字）\n注意: JSON部分にコードブロック記号(```)は付けないこと。\n\n【おまかせモード特別指示】\n- 必ず10品前後の完全なコーディネートを作成\n- カテゴリバランスを考慮（フード3品以上、ドリンク人数分、デザート1品以上）\n- 総額が高額になりすぎないよう配慮"}}
{"ts":"2025-08-14 07:27:37","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":2275,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Received raw response","ctx":{"order_session_id":null,"raw":"```json\n[{\"product_id\":121,\"qty\":1},{\"product_id\":119,\"qty\":2},{\"product_id\":187,\"qty\":1},{\"product_id\":281,\"qty\":1},{\"product_id\":78,\"qty\":2},{\"product_id\":138,\"qty\":1},{\"product_id\":57,\"qty\":1},{\"product_id\":157,\"qty\":1},{\"product_id\":190,\"qty\":1},{\"product_id\":278,\"qty\":1}]\n```\n\n朝食ですか！☀️お子様もいらっしゃるようなので、特製お子様カレー🍛はいかがでしょう？20cmスパイシーチキン🍗も朝から元気が出ますよ！燻製チーズピザ🍕はみんなでシェア！紙皿セットと赤ワイン🍷はいかがですか？ノンアルにはアップルシナモンのクラフトソーダ🍎、チーズケーキ🍰、花火🎆もご用意しました！薪とBBQレンタルBOXで準備万端！🔥\n"}}
{"ts":"2025-08-14 07:27:37","level":"INFO","rid":"ai689d11574bab1441083300","elapsed_ms":2279,"file":"get_recommendations.php","line":50,"func":"getRecommendations","mem_now_kb":2048,"mem_peak_kb":2048,"msg":"Saved assistant message to database","ctx":{"order_session_id":null}}
