### ざっくり振り返り✍️  
（※「どんな事故が起きて → 何を直したか」「触ったファイル」を中心にまとめました）

---

#### 2024-09-30 ～ 10-03  
| トラブル | 原因 | 触った主なファイル |
|---|---|---|
| **JSON のはずが HTML コメント混入でフロントが死ぬ** | デバッグ用 `echo "<!-- … -->"` が API レスポンスの頭に出ちゃった | `/api/v1/products/categories.php` |
| **500 Error: “Class SquareService not found”** | `SquareService.php` を `require_once` してなかった | `categories.php`, `products/index.php` |
| **Database.php がまた HTML 吐く** | `DEBUG_MODE` で `echo` してた | `/api/lib/Database.php`, `config.php` |

---

#### 2024-10-03 ～ 10-05  
| トラブル | 原因 | 触った主なファイル |
|---|---|---|
| **商品 API 500 & アイコン画像 404** | 同じ require 漏れ＋アイコンの物理ファイルなし | `products/index.php`, 画像を `/order/images/icons/` 配置 |
| **カテゴリ並び順カスタムしたい** | 専用テーブルが無く直接クエリ順 | `category_descripter` 新規作成, `ProductService.php` |

---

#### 10-05  
| トラブル | 原因 | 触った主なファイル |
|---|---|---|
| **商品画像ぜんぶ 404** | Square は “画像ID→直URL” の変換が必要なのに ID だけ保存してた | `ProductService.php`（`processImageUrl` 追加・既存メソッド改修） |

---

#### 2025-05-03  
| トラブル | 原因 | 触った主なファイル |
|---|---|---|
| **同期結果パース失敗** | 統一されてない JSON 構造 | `/api/v1/products/sync.php` |
| **Square 画像検索で SDK 型エラー** | v16 から配列→リクエストオブジェクト必須 | `ProductService.php` (`searchCatalogObjects` 呼び出し修正) |
| **無限同期** | `product_sync_interval` が設定ゼロ | `system_settings` 新レコード, `install_sync_interval.php` |

---

#### 2025-05-04  
| トラブル | 原因 | 触った主なファイル |
|---|---|---|
| **カテゴリ API が黙る → フロント “カテゴリ読み込み失敗”** | `getCategories()` タイムアウト／例外未捕捉 | `categories.php`, `ProductService.php` |
| **`getCategories is not defined`** | API クラスをインスタンス化したのに UI 側が直関数呼び | `app.js`（`window.apiClient` 生成）、`ui.js`（ラッパー追加）、`liff-init.js`（初期化順調整） |

---

### まとめ
* **根本的には**「デバッグ出力がレスポンスに混ざる」「ファイル読込漏れ」「Square SDK の仕様変更追従漏れ」「フロントと API のインターフェイス食い違い」が多発。  
* **対策は** “echo→error_log 化” と “require_once 整理”、SDK 呼び出しを最新版に合わせる、フロント側は **global `apiClient`** で統一、そして DB に制御テーブル／設定値を追加。  
* **触った場所** はほぼ `ProductService.php` と各 API php、フロントの `api.js / ui.js / app.js / liff-init.js` が中心です。